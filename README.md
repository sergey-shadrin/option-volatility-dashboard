# Описание
Cредство для отображения диаграммы волатильностей опционов, торгуемых на Московской Бирже.

![Interface sample](docs/interface_sample.png)

Для заданного базового актива диаграмма отображает данные из всех доступных опционных серий.
Цена последней сделки базового актива отображается на диаграмме вертикальной чертой.
По каждой серии для набора страйков вокруг центрального доступны следующие данные:
* Биржевая волатильность (Volatility)
* Отдельно по опционам Call и Put
  * Волатильность по лучшей цене продажи (Call Ask, Put Ask)
  * Волатильность по лучшей цене покупки (Call Bid, Put Bid)
  * Волатильность по цене последней сделки (Call Last Price, Put Last Price)

Биржевая волатильность получается из данных брокера.
Остальные волатильности вычисляются приложением по [модели Блэка-Шоулза](https://en.wikipedia.org/wiki/Implied_volatility).
Данные на диаграмме обновляются каждые 3 секунды.

Диаграмма строится на основе данных, полученных из доступных открытых API.
На данный момент используются:
* [ISS MOEX](https://iss.moex.com/iss/reference/)
* [Alor Open API](https://alor.dev/docs)

# Требования к системе
* Linux
* bash
* docker

# Конфигурация
Приложение конфигурируется с помощью переменных окружения.
В проекте находятся файлы `.env.dist`, на основе которых требуется создать свой файл `.env`
Только после создания и корректной настройки файлов `.env` приложение можно запускать

# Секретные данные
На данный момент у приложения есть только одна переменная, которая содержит закрытые данные
Это клиентский ключ доступа к [Alor Open API](https://alor.dev/docs)
Без корректного ключа доступа приложение работать не будет.

# Worflow

## Разработка
* Код компонентов приложения расположен в директориях app/<имя компонента>/src
* Для запуска локально сначала нужно собрать runtime Docker-образ
* Запуск приложения для отладки можно выполнить с помощью скриптов `bin/run-app.sh`, `bin/run-all.sh`
* Остановку приложения можно выполнить с помощью скрипта `bin/stop-app.sh`, `bin/stop-all.sh`

## Сборка
Этапы сборки:
* Сборка builder-образа Docker
* Сборка проекта в директории проекта
* Сборка base-образа Docker
* Сборка runtime-образа Docker

Подробнее см. `bin/build-all.sh`

## Развертывание

### Обновить набор базовых активов
* Открыть файл `app/backend/src/app/supported_base_asset.py`
* Структура файла - словарь MAP, состоящий из словарей базовых активов
  * ключи словаря MAP - тикеры базовых активов
    * strike_step - шаг страйка
    * max_strikes_count - максимальное количество отслеживаемых страйков
* После обновления файла нужно выполнить merge изменений в master-ветку репозитория
* После появления изменений в мастер-ветке автоматически выполнится github-action `Build and deploy backend`
  * Выполнится сборка новой версии приложения
  * Выполнится развертывание новой версии приложения

### Принудительно перезапустить приложение
> При условии доступов к Github actions данного репозитория

* Перейти во вкладку "Actions"
* Выполнить action "Deploy app"